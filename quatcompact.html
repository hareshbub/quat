<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QUAT Compact</title>

<style>
/* ===== DEFAULTS (DEV CAN OVERRIDE) ===== */
#quat{
  --quat-primary:#2563eb;
  --quat-submit:#7c3aed;
  --quat-success:#22c55e;
  --quat-fail:#ef4444;
  --quat-border:#64748b;
  --quat-bg:transparent;
  --quat-text:inherit;
}

#quat{
  color:var(--quat-text);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
  background:var(--quat-bg);
  font-family:system-ui,sans-serif;
}

/* ===== HERO ===== */
#hero{
  display:flex;
  align-items:center;
  gap:14px;
}

.circle{
  width:46px;height:46px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;
  cursor:pointer;
  user-select:none;
  background:var(--quat-primary);
}
.circle.submit{background:var(--quat-submit);}

.boxes{display:flex;gap:6px;}
.box{
  width:38px;height:38px;
  border:2px solid var(--quat-border);
  background:transparent;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;
}
.box.active{
  background:var(--quat-success);
  border-color:var(--quat-success);
}

/* ===== STATUS ===== */
#status{
  font-size:13px;
  min-height:18px;
}
.fail{color:var(--quat-fail);}

/* ===== VERIFIED ===== */
#verified{
  display:none;
  align-items:center;
  gap:8px;
  font-size:16px;
  font-weight:600;
  color:var(--quat-success);
}
</style>
</head>

<body>

<div id="quat">

  <div id="hero">
    <div class="circle" id="tap">‚óè</div>

    <div class="boxes">
      <div class="box"></div>
      <div class="box"></div>
      <div class="box"></div>
      <div class="box"></div>
    </div>

    <div class="circle submit" id="submit">‚óè</div>
  </div>

  <div id="status"></div>
  <div id="verified">‚úî Verified by QUAT</div>

</div>

<script>
/* ===== SILENT CONSOLE ===== */
(()=>{["log","warn","error","debug","info","trace"].forEach(k=>console[k]=()=>{});})();

/* ===== CONFIG ===== */
const LETTERS=["Q","U","A","T"];
const MIN=80,MAX=350;

/* ===== DEVICE ===== */
const IS_TOUCH=("ontouchstart"in window)||navigator.maxTouchPoints>0;

/* ===== STATE ===== */
let clicks=[],submitted=false;

/* ===== ELEMENTS ===== */
const boxes=document.querySelectorAll(".box");
const hero=document.getElementById("hero");
const status=document.getElementById("status");
const verified=document.getElementById("verified");
const tap=document.getElementById("tap");
const submit=document.getElementById("submit");

/* ===== UI ===== */
function paint(){
  boxes.forEach((b,i)=>{
    b.classList.toggle("active",i<clicks.length);
    b.textContent=i<clicks.length?LETTERS[i]:"";
  });
}

/* ===== RESET ===== */
function resetAll(){
  clicks=[];
  submitted=false;
  boxes.forEach(b=>{b.classList.remove("active");b.textContent="";});
  status.textContent="";
}

/* ===== TAP ===== */
tap.addEventListener("pointerdown",e=>{
  if(submitted||!e.isTrusted||clicks.length>=4) return;
  clicks.push(performance.now());
  paint();
});

/* ===== SUBMIT ===== */
submit.addEventListener("pointerdown",e=>{
  if(submitted||!e.isTrusted) return;
  submitted=true;

  if(clicks.length!==4){
    fail("Incomplete interaction");
    return;
  }

  const t=[
    clicks[1]-clicks[0],
    clicks[2]-clicks[1],
    clicks[3]-clicks[2]
  ];

  const timingOK=t.every(v=>v>=MIN&&v<=MAX);
  timingOK ? success() : fail("Behavior verification failed");
});

/* ===== SUCCESS ===== */
function success(){
  hero.style.display="none";
  verified.style.display="flex";

  // üîî SIGNAL TO WEBSITE
  window.dispatchEvent(new CustomEvent("quat:verified",{
    detail:{verified:true, method:"QUAT"}
  }));
}

/* ===== FAIL ===== */
function fail(msg){
  status.textContent=msg;
  status.className="fail";
  setTimeout(()=>{
    status.className="";
    resetAll();
  },900);
}
</script>

</body>
</html>
